
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Code Examples &#8212; zfp 0.5.5 documentation</title>
    <link rel="stylesheet" href="_static/pyramid.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '0.5.5',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Regression Tests" href="testing.html" />
    <link rel="prev" title="File Compressor" href="zfpcmd.html" />
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Neuton&amp;subset=latin" type="text/css" media="screen" charset="utf-8" />
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Nobile:regular,italic,bold,bolditalic&amp;subset=latin" type="text/css" media="screen" charset="utf-8" />
<!--[if lte IE 6]>
<link rel="stylesheet" href="_static/ie6.css" type="text/css" media="screen" charset="utf-8" />
<![endif]-->

  </head>
  <body>

    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="testing.html" title="Regression Tests"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="zfpcmd.html" title="File Compressor"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">zfp 0.5.5 documentation</a> &#187;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="code-examples">
<h1>Code Examples<a class="headerlink" href="#code-examples" title="Permalink to this headline">¶</a></h1>
<p>The <code class="file docutils literal"><span class="pre">examples</span></code> directory includes five programs that make use of the
compressor.</p>
<div class="section" id="simple-compressor">
<span id="ex-simple"></span><h2>Simple Compressor<a class="headerlink" href="#simple-compressor" title="Permalink to this headline">¶</a></h2>
<p>The <strong class="program">simple</strong> program is a minimal example that shows how to call
the compressor and decompressor on a double-precision 3D array.  Without
the <code class="code docutils literal"><span class="pre">-d</span></code> option, it will compress the array and write the compressed
stream to standard output.  With the <code class="code docutils literal"><span class="pre">-d</span></code> option, it will instead
read the compressed stream from standard input and decompress the
array:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">simple</span> <span class="o">&gt;</span> <span class="n">compressed</span><span class="o">.</span><span class="n">zfp</span>
<span class="n">simple</span> <span class="o">-</span><span class="n">d</span> <span class="o">&lt;</span> <span class="n">compressed</span><span class="o">.</span><span class="n">zfp</span>
</pre></div>
</div>
<p>For a more elaborate use of the compressor, see the
<a class="reference internal" href="zfpcmd.html#zfpcmd"><span class="std std-ref">zfp utility</span></a>.</p>
</div>
<div class="section" id="diffusion-solver">
<span id="ex-diffusion"></span><h2>Diffusion Solver<a class="headerlink" href="#diffusion-solver" title="Permalink to this headline">¶</a></h2>
<p>The <strong class="program">diffusion</strong> example is a simple forward Euler solver for the
heat equation on a 2D regular grid, and is intended to show how to declare
and work with zfp’s compressed arrays, as well as give an idea of how
changing the compression rate and cache size affects the error in the
solution and solution time.  The usage is:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">diffusion</span> <span class="p">[</span><span class="o">-</span><span class="n">i</span><span class="p">]</span> <span class="p">[</span><span class="o">-</span><span class="n">n</span> <span class="n">nx</span> <span class="n">ny</span><span class="p">]</span> <span class="p">[</span><span class="o">-</span><span class="n">p</span><span class="p">]</span> <span class="p">[</span><span class="o">-</span><span class="n">t</span> <span class="n">nt</span><span class="p">]</span> <span class="p">[</span><span class="o">-</span><span class="n">r</span> <span class="n">rate</span><span class="p">]</span> <span class="p">[</span><span class="o">-</span><span class="n">c</span> <span class="n">blocks</span><span class="p">]</span>
</pre></div>
</div>
<p>where <em>rate</em> specifies the exact number of compressed bits to store per
double-precision floating-point value (default = 64); <em>nx</em> and <em>ny</em>
specify the grid size (default = 100 × 100); <em>nt</em> specifies the number
of time steps to take (the default is to run until time <em>t</em> = 1); and <em>blocks</em>
is the number of uncompressed blocks to cache (default = <em>nx</em> / 2).  The
<code class="code docutils literal"><span class="pre">-i</span></code> option enables array traversal via iterators instead of indices.</p>
<p>The <code class="code docutils literal"><span class="pre">-p</span></code> option enables OpenMP parallel execution, which makes use
of both mutable and immutable <a class="reference internal" href="arrays.html#private-immutable-view"><span class="std std-ref">private views</span></a>
for thread-safe array access.  Note that this example has not been
optimized for parallel performance, but rather serves to show how to
work with zfp’s compressed arrays in a multithreaded setting.</p>
<p>Running diffusion with the following arguments:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">diffusion</span> <span class="o">-</span><span class="n">r</span> <span class="mi">8</span>
<span class="n">diffusion</span> <span class="o">-</span><span class="n">r</span> <span class="mi">12</span>
<span class="n">diffusion</span> <span class="o">-</span><span class="n">r</span> <span class="mi">20</span>
<span class="n">diffusion</span> <span class="o">-</span><span class="n">r</span> <span class="mi">64</span>
</pre></div>
</div>
<p>should result in this output:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">rate</span><span class="o">=</span><span class="mi">8</span> <span class="nb">sum</span><span class="o">=</span><span class="mf">0.996442</span> <span class="n">error</span><span class="o">=</span><span class="mf">4.813938e-07</span>
<span class="n">rate</span><span class="o">=</span><span class="mi">12</span> <span class="nb">sum</span><span class="o">=</span><span class="mf">0.998338</span> <span class="n">error</span><span class="o">=</span><span class="mf">1.967777e-07</span>
<span class="n">rate</span><span class="o">=</span><span class="mi">20</span> <span class="nb">sum</span><span class="o">=</span><span class="mf">0.998326</span> <span class="n">error</span><span class="o">=</span><span class="mf">1.967952e-07</span>
<span class="n">rate</span><span class="o">=</span><span class="mi">64</span> <span class="nb">sum</span><span class="o">=</span><span class="mf">0.998326</span> <span class="n">error</span><span class="o">=</span><span class="mf">1.967957e-07</span>
</pre></div>
</div>
<p>For speed and quality comparison, the solver solves the same problem using
uncompressed double-precision arrays when <code class="code docutils literal"><span class="pre">-r</span></code> is omitted.</p>
<p>The <strong class="program">diffusionC</strong> program is the same example written entirely
in C using the cfp <a class="reference internal" href="arrays.html#cfp"><span class="std std-ref">wrappers</span></a> around the C++ compressed array
classes.</p>
</div>
<div class="section" id="speed-benchmark">
<span id="ex-speed"></span><h2>Speed Benchmark<a class="headerlink" href="#speed-benchmark" title="Permalink to this headline">¶</a></h2>
<p>The <strong class="program">speed</strong> program takes two optional parameters:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">speed</span> <span class="p">[</span><span class="n">rate</span><span class="p">]</span> <span class="p">[</span><span class="n">blocks</span><span class="p">]</span>
</pre></div>
</div>
<p>It measures the throughput of compression and decompression of 3D
double-precision data (in megabytes of uncompressed data per second).
By default, a rate of 1 bit/value and two million blocks are
processed.</p>
</div>
<div class="section" id="pgm-image-compression">
<span id="ex-pgm"></span><h2>PGM Image Compression<a class="headerlink" href="#pgm-image-compression" title="Permalink to this headline">¶</a></h2>
<p>The <strong class="program">pgm</strong> program illustrates how zfp can be used to compress
grayscale images in the
<a class="reference external" href="http://netpbm.sourceforge.net/doc/pgm.html">pgm format</a>.  The usage is:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">pgm</span> <span class="o">&lt;</span><span class="n">param</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="nb">input</span><span class="o">.</span><span class="n">pgm</span> <span class="o">&gt;</span><span class="n">output</span><span class="o">.</span><span class="n">pgm</span>
</pre></div>
</div>
<p>If <code class="code docutils literal"><span class="pre">param</span></code> is positive, it is interpreted as the rate in bits per pixel,
which ensures that each block of 4 × 4 pixels is compressed to a fixed
number of bits, as in texture compression codecs.
If <code class="code docutils literal"><span class="pre">param</span></code> is negative, then fixed-precision mode is used with precision
<code class="code docutils literal"><span class="pre">-param</span></code>, which tends to give higher quality for the same rate.  This
use of zfp is not intended to compete with existing texture and image
compression formats, but exists merely to demonstrate how to compress 8-bit
integer data with zfp.  See FAQs <a class="reference internal" href="faq.html#q-relerr"><span class="std std-ref">#20</span></a> and
<a class="reference internal" href="faq.html#q-lossless"><span class="std std-ref">#21</span></a> for information on the effects of setting the
precision.</p>
</div>
<div class="section" id="in-place-compression">
<span id="ex-inplace"></span><h2>In-place Compression<a class="headerlink" href="#in-place-compression" title="Permalink to this headline">¶</a></h2>
<p>The <strong class="program">inplace</strong> example shows how one might use zfp to perform in-place
compression and decompression when memory is at a premium.  Here the
floating-point array is overwritten with compressed data, which is later
decompressed back in place.  This example also shows how to make use of
some of the low-level features of zfp, such as its low-level, block-based
compression API and bit stream functions that perform seeks on the bit
stream.  The program takes one optional argument:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">inplace</span> <span class="p">[</span><span class="n">tolerance</span><span class="p">]</span>
</pre></div>
</div>
<p>which specifies the fixed-accuracy absolute tolerance to use during
compression.  Please see <a class="reference internal" href="faq.html#q-inplace"><span class="std std-ref">FAQ #19</span></a> for more on the
limitations of in-place compression.</p>
</div>
<div class="section" id="iterators">
<span id="ex-iterators"></span><h2>Iterators<a class="headerlink" href="#iterators" title="Permalink to this headline">¶</a></h2>
<p>The <strong class="program">iterator</strong> example illustrates how to use zfp’s
compressed-array iterators and pointers for traversing arrays.  For
instance, it gives an example of sorting a 1D compressed array
using <code class="xref cpp cpp-func docutils literal"><span class="pre">std::sort()</span></code>.  This example takes no command-line
options.</p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Code Examples</a><ul>
<li><a class="reference internal" href="#simple-compressor">Simple Compressor</a></li>
<li><a class="reference internal" href="#diffusion-solver">Diffusion Solver</a></li>
<li><a class="reference internal" href="#speed-benchmark">Speed Benchmark</a></li>
<li><a class="reference internal" href="#pgm-image-compression">PGM Image Compression</a></li>
<li><a class="reference internal" href="#in-place-compression">In-place Compression</a></li>
<li><a class="reference internal" href="#iterators">Iterators</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="zfpcmd.html"
                        title="previous chapter">File Compressor</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="testing.html"
                        title="next chapter">Regression Tests</a></p>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <div><input type="text" name="q" /></div>
      <div><input type="submit" value="Go" /></div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="testing.html" title="Regression Tests"
             >next</a> |</li>
        <li class="right" >
          <a href="zfpcmd.html" title="File Compressor"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">zfp 0.5.5 documentation</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2014-2019, LLNL-CODE-663824.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.6.7.
    </div>
  </body>
</html>